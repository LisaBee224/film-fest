<h1> Films Show </h1>

<h2> <%= @film.name %> </h2><br>

<%= @film.description %>

<%= @film.cast %><br>

<%= @film.crew %><br>

<% if @film.ratings %>
  <p>Average audience rating:<%= @film.user_avg %></p>
  <p>Average judge rating:<%= @film.judge_avg %></p>
<%end%>

<p>Rate this film:</p>

<% if logged_in? %>
  <%= form_for @film, method: :post, url: :film_rating do |f| %>
  <%= f.hidden_field :user_id, value: current_user.id %>
  <%= f.hidden_field :film_id, value: @film.id %>
  <%= f.select :ratings, [5, 4.5, 4, 3.5, 3, 2.5, 2, 1.5, 1], :prompt => 'Select One' %>

  <%=f.submit %>

  <%end%>
<% else %>
  <p>
    Please <a href="/signup">Signup</a> or <a href="/login">Login</a> to rate this film
  </p>
<% end %>

<h2>Reviews for <%=@film.name %></h2>




<h3> <%= @film.name %>'s Reviews: </h3>

<% @reviews.each do |review| %>
  <ul> Review Title: <%= review.title %> </ul>
  <ul> Review Body: <%= review.body %> </ul>

  <% if logged_in? %>
    <%= link_to 'Create Comment', "/reviews/#{review.id}/comments/new" %>
  <% end %><br>


  <% review.comments.each do |comment| %>
    <ul>
      <li> comment: <%= comment.body %> </li>
      <% if comment.user_id == current_user.id %>
        <li><%=link_to 'edit your comment', "reviews/#{review.id}/comments/#{comment.id}/edit" %></li>
      <%end%>
      <li><%=form_for comment, :url =>{:action =>"update", :method=> "patch", :controller => "comments"} do |f| %>
          <%=f.hidden_field :flag, value: true %>
          <%=f.hidden_field :comment_id, value: comment.id %>
          <%=f.submit 'Flag as Inappropriate' %></li>
      <%end%>
    </ul>
  <% end %>
<% end %>

<% if logged_in? %>
  <%= link_to 'Create a new review', "/films/#{@film.id}/reviews/new" %>
<% end %><br>

<%= link_to 'Back to Category list', "/categories/#{@film.category_id}"%>
